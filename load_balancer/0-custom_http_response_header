#!/usr/bin/env bash
# Configure Nginx with custom HTTP header

# Update and install Nginx
sudo apt update -y
sudo apt install nginx -y

# Get the hostname of the server
SERVER_NAME=$(hostname)

# Create or modify the Nginx configuration file to add custom header
CONFIG_PATH="/etc/nginx/sites-available/default"

# Add custom header configuration to Nginx
sed -i "/server_name _;/a \\\tadd_header X-Served-By $SERVER_NAME;" "$CONFIG_PATH"

# Enable the site if not already enabled
ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/

# Start Nginx if not running, restart if running
if pgrep nginx > /dev/null; then
    service nginx restart
else
    service nginx start
fi
